# Next.js & Vercel Rules

## Next.js App Router

- **App Router only** - Use `src/app/` directory structure
- **Server Components by default** - Only use `"use client"` when needed
- **Route handlers** - Use for API endpoints (`src/app/api/**/route.ts`)
- **Server actions** - Prefer over client mutations
- **Metadata** - Use Next.js metadata API for SEO

## Vercel Platform

- **Node.js runtime** - Default runtime (use Edge only with justification)
- **Environment variables** - Use Vercel dashboard for secrets
- **Feature flags** - Use Vercel Feature Flags for rollouts
- **Cron jobs** - Use Vercel Cron (configure in `vercel.json`)
- **Observability** - Use Vercel Analytics and Speed Insights
- **Edge runtime** - Only use when explicitly needed (document why)

## Deployment

- **Automatic deployments** - From `main` branch
- **Preview deployments** - From pull requests
- **Environment variables** - Set in Vercel dashboard
- **Build settings** - Use Vercel defaults unless justified

## Performance

- **Image optimization** - Use Next.js Image component
- **Font optimization** - Use Next.js font optimization
- **Code splitting** - Automatic with App Router
- **Caching** - Use appropriate cache strategies

## API Routes

- **Route handlers** - Use for REST endpoints
- **tRPC** - Use for type-safe APIs (preferred)
- **Error handling** - Return proper HTTP status codes
- **Validation** - Validate all inputs with Zod
