# Stripe Billing

- Subscription states: trial → active → past_due → churned
- Webhooks verify signature and are idempotent
- Entitlements enforced in API + UI
- Always verify webhook signatures using `stripe.webhooks.constructEvent()`
- Never process webhooks without signature verification
- Return appropriate error codes for invalid signatures
- Webhook handler in `src/app/api/webhooks/stripe/route.ts`
- Use Stripe client from `@/lib/stripe`
- Handle all Stripe events appropriately
- Use Stripe types for type safety
- Never log PII in webhook handlers
