# Playbook: New Feature

## Step Sequence

```
Insight + Narrative → PRD → flows/edge cases (parallel OK) → ADR + schema + router plan → test plan + stubs → build (small diffs) → a11y audit + fix loop → test verify → PRD acceptance check
```

## Steps

### 1. Insight & Narrative Strategist
**Input**: Raw product/feature idea  
**Output**: Unfair Insight + Narrative document

**Required Artifacts**:
- Insight document in `docs/product/INSIGHT-<product>.md`
- Unfair insight (what do we know that others don't?)
- Narrative (emotional hook + transformation story)
- Target community identification
- Early signals definition
- 5 demand-validation tests (no-code/human first)
- Distribution wedge
- Recommendation (proceed, pivot, or kill)

**Deliverables**:
- Unfair insight documented
- Narrative crafted with emotional hook
- Target community identified
- Early signals defined
- Demand-validation tests designed
- Distribution wedge identified
- Clear recommendation (proceed/pivot/kill)

**Note**: Only proceed to PRD if recommendation is PROCEED. This prevents waste by ensuring signal before building.

### 2. Product Strategist PRD
**Input**: Feature request or user need  
**Output**: Product Requirements Document

**Required Artifacts**:
- PRD document in `docs/prd/<feature-name>.md`
- User stories and acceptance criteria
- Success metrics definition
- Risk assessment

**Deliverables**:
- User problems and JTBD (Jobs To Be Done) documented
- Success metrics defined
- Edge cases and failure modes documented
- Stakeholder alignment obtained

### 2. IA Designer flows/edge cases (parallel OK)
**Input**: PRD  
**Output**: Information architecture and user flows

**Required Artifacts**:
- User flow diagrams in `docs/flows/<feature-name>/`
- Edge case documentation
- Wireframes or mockups
- IA documentation

**Deliverables**:
- Information architecture designed
- User flows created and validated
- Edge cases documented
- Interaction patterns defined

**Note**: Can run in parallel with PRD refinement

### 3. Engineering Architect ADR + schema + router plan
**Input**: PRD, flows  
**Output**: Architecture Decision Record, schema design, router plan

**Required Artifacts**:
- ADR document in `docs/adr/<number>-<feature-name>.md`
- Schema design in `drizzle/schema.ts` (or feature-specific schema)
- Router plan in `src/features/<feature>/data/router.ts` (structure)
- Technical design document

**Deliverables**:
- ADR created with decision rationale
- Database schema designed
- tRPC router structure planned
- Feature module structure defined
- Patterns and conventions documented

### 4. Test Engineer test plan + stubs
**Input**: ADR, schema, router plan  
**Output**: Test plan and test stubs

**Required Artifacts**:
- Test plan document
- Unit test stubs in `src/features/<feature>/domain/*.test.ts`
- Integration test stubs in `src/features/<feature>/data/*.test.ts`
- E2E test stubs in `e2e/<feature>/*.spec.ts`

**Deliverables**:
- Test plan covering all scenarios
- Test stubs with clear descriptions
- Edge case test scenarios defined
- **Tests must be written before implementation**

### 5. Implementer build (small diffs)
**Input**: ADR, schema, router plan, test stubs  
**Output**: Implemented feature

**Required Artifacts**:
- Feature module in `src/features/<feature>/`
  - `domain/schemas.ts` - Zod schemas
  - `domain/types.ts` - TypeScript types
  - `data/router.ts` - tRPC procedures
  - `data/actions.ts` - Server actions
  - `ui/` - React components
  - `index.ts` - Public API

**Deliverables**:
- Feature module structure created
- Domain logic implemented
- Server actions and tRPC procedures created
- UI components with all states (loading/empty/error/success)
- Observability events added (success/failure)
- Integration with existing systems

**Rules**:
- Keep diffs small (one concern at a time)
- Run tests after each change
- Commit frequently with logical units

### 6. Accessibility audit + fix loop
**Input**: Implemented feature  
**Output**: Accessibility fixes

**Required Artifacts**:
- Accessibility audit report
- Fixed accessibility issues
- WCAG 2.2 AA compliance verification

**Deliverables**:
- UI audited for WCAG 2.2 AA compliance
- Screen reader testing completed
- Keyboard navigation verified
- Color contrast checked
- All accessibility issues fixed

**Process**:
- Audit → Fix → Re-audit → Fix (loop until all issues resolved)

### 7. Test verify
**Input**: Complete feature with a11y fixes  
**Output**: Verified test results

**Deliverables**:
- All unit tests passing
- All integration tests passing
- All E2E tests passing
- No regressions introduced
- Test coverage verified

### 8. PRD acceptance check
**Input**: Complete feature, test results  
**Output**: PRD acceptance confirmation

**Deliverables**:
- Feature matches PRD requirements
- Acceptance criteria met
- Success metrics baseline established
- Stakeholder sign-off obtained

## Definition of Done Checklist

A feature is considered done when:

- ✅ PRD approved by stakeholders
- ✅ User flows validated
- ✅ ADR created and reviewed
- ✅ All tests written and passing (green)
- ✅ Observability events added (success/failure)
- ✅ All UI states exist (loading/empty/error/success)
- ✅ Documentation updated
- ✅ WCAG 2.2 AA compliance verified (a11y pass)
- ✅ Code review completed
- ✅ No linting or type errors
- ✅ PRD acceptance check passed
- ✅ Ready for merge

## Quality Gates

Each step must pass quality gates before proceeding:
- **PRD**: Stakeholder approval
- **Flows**: User validation
- **ADR**: Technical review
- **Test Plan**: Coverage verified
- **Build**: Tests passing, code review, linting, type checking
- **A11y**: WCAG 2.2 AA compliance
- **Test Verify**: All tests green
- **PRD Acceptance**: Requirements met
